---

- hosts: all
  vars:
    - stack_home: "/opt/stack"
    - os_faults_home: "/opt/stack/os-faults"
  tasks:

    - name: Create folder for OS-Faults config
      file:
        path: "{{ stack_home }}/.config/openstack"
        state: directory
        mode: 0755
      become: yes
      become_user: stack

    - name: Create OS-Faults config file
      shell: |
        cat {{ os_faults_home}}/os_faults/tests/devstack/os-faults-universal.yaml > {{ stack_home }}/.config/openstack/os-faults.yaml
      become: yes
      become_user: stack

    - name: Check connectivity using command-line tool
      command: tox -e venv -- os-inject-fault -vd
      args:
        chdir: "{{ os_faults_home }}"
      become: yes
      become_user: stack
